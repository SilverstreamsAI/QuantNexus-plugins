{
  "$schema": "https://quantnexus.io/schemas/plugin-manifest.json",
  "id": "com.quantnexus.backtest",
  "name": "Backtest Engine",
  "version": "1.0.0",
  "description": "Strategy backtesting engine with performance analytics and trade simulation",
  "author": "QuantNexus Team",
  "homepage": "https://quantnexus.io/plugins/backtest",
  "license": "MIT",

  "main": "./dist/index.js",
  "type": "execution",
  "category": "trading",

  "contributes": {
    "commands": [
      {
        "id": "backtest.run",
        "title": "Run Backtest",
        "category": "Backtest",
        "keybinding": "F5"
      },
      {
        "id": "backtest.stop",
        "title": "Stop Backtest",
        "category": "Backtest",
        "keybinding": "Shift+F5"
      },
      {
        "id": "backtest.clear",
        "title": "Clear Results",
        "category": "Backtest"
      },
      {
        "id": "backtest.export",
        "title": "Export Results",
        "category": "Backtest",
        "keybinding": "Ctrl+Shift+E"
      },
      {
        "id": "backtest.optimize",
        "title": "Optimize Parameters",
        "category": "Backtest"
      }
    ],
    "settings": [
      {
        "id": "backtest.initialCapital",
        "title": "Initial Capital",
        "type": "number",
        "default": 100000,
        "minimum": 1000,
        "description": "Starting capital for backtests"
      },
      {
        "id": "backtest.commission",
        "title": "Commission Rate",
        "type": "number",
        "default": 0.001,
        "minimum": 0,
        "maximum": 0.1,
        "description": "Trading commission rate (e.g., 0.001 = 0.1%)"
      },
      {
        "id": "backtest.slippage",
        "title": "Slippage",
        "type": "number",
        "default": 0.0001,
        "minimum": 0,
        "description": "Simulated slippage per trade"
      },
      {
        "id": "backtest.marginRate",
        "title": "Margin Rate",
        "type": "number",
        "default": 1.0,
        "minimum": 0.1,
        "maximum": 10.0,
        "description": "Margin/leverage ratio (1.0 = no leverage)"
      },
      {
        "id": "backtest.riskFreeRate",
        "title": "Risk-Free Rate",
        "type": "number",
        "default": 0.02,
        "minimum": 0,
        "maximum": 0.2,
        "description": "Annual risk-free rate for Sharpe calculation"
      }
    ]
  },

  "permissions": [
    "network:internal",
    "database"
  ],

  "isolation": "trusted",

  "activationEvents": [
    "onCommand:backtest.*"
  ],

  "dependencies": {
    "com.quantnexus.data": "^1.0.0"
  },

  "configSchema": {
    "type": "object",
    "properties": {
      "execution": {
        "type": "object",
        "title": "Execution Settings",
        "properties": {
          "fillModel": {
            "type": "string",
            "enum": ["close", "next_open", "vwap"],
            "default": "close",
            "description": "Order fill price model"
          },
          "allowPartialFills": {
            "type": "boolean",
            "default": false,
            "description": "Allow partial order fills"
          },
          "checkVolume": {
            "type": "boolean",
            "default": true,
            "description": "Check volume constraints for fills"
          },
          "maxVolumePercent": {
            "type": "number",
            "default": 0.1,
            "description": "Max percent of bar volume per order"
          }
        }
      },
      "risk": {
        "type": "object",
        "title": "Risk Management",
        "properties": {
          "maxPositionSize": {
            "type": "number",
            "default": 0.2,
            "description": "Max position size as percent of equity"
          },
          "maxDrawdown": {
            "type": "number",
            "default": 0.25,
            "description": "Max drawdown before stopping"
          },
          "stopOnMaxDrawdown": {
            "type": "boolean",
            "default": false,
            "description": "Stop backtest on max drawdown"
          }
        }
      },
      "output": {
        "type": "object",
        "title": "Output Settings",
        "properties": {
          "saveResults": {
            "type": "boolean",
            "default": true,
            "description": "Save results to database"
          },
          "saveTrades": {
            "type": "boolean",
            "default": true,
            "description": "Save trade history"
          },
          "saveEquityCurve": {
            "type": "boolean",
            "default": true,
            "description": "Save equity curve data"
          }
        }
      }
    }
  }
}
